<!DOCTYPE html>
<html>
  {{ partial "head.html" . }}
  <body>
    <!-- MAIN -->
    <main class="hovering__main">
      <div class="hovering__main__hero">

        <!-- INFORMATION CONTAINER -->
        <div>

        </div>
        <div class="hovering__information__container">
          <div class="hovering__state__container">
            <div id="hovering__state--app" class="hovering__state">INITIAL</div>
            <div id="hovering__state--button" class="hovering__state">false</div>
          </div>
    
          <div class="hovering__timer__container">
            <div id="hovering__timer" class="hovering__timer">0:00</div>
          </div>
  
          <div class="hovering__legend__container">
            <div class="hovering__legend">Press space to start session.</div>
          </div>      
        </div>
          
        <!-- HOVERING BUTTON -->
        <div class="hovering__center">
          <div class="hovering__toast__container">
            <div id="hovering__toast__text" class="hovering__toast__text">

            </div>
          </div>

          <div id="hovering__button__container" class="hovering__button__container">
            <div id="hovering__button" class="hovering__button">
            </div>  
            <div id="hovering__button__text" class="hovering__button__text">hover</div>
          </div>

          <!-- HOVERING MESSAGE -->
          <div class="hovering__message__container">
            <div id="hovering__message" class="hovering__message">
              <p>Hover on the button to begin.</p>
            </div>
          </div>
        </div>
              
        <!-- WHAT IS HOVERING? -->
        

      </div>
    </main>
  </body>

  <script>
    // hovering tally. 
    // You can input a time. 
    // Timed. Non-timed. 

    // selectors
    var hovering__button__container = document.querySelector('#hovering__button__container');
    var hovering__button__text = document.querySelector('#hovering__button__text');
    var hovering__button = document.querySelector('#hovering__button');
    var hovering__message = document.querySelector('#hovering__message');
    var hovering__message__secondary = document.querySelector('#hovering__message__secondary');
    var hovering__timer = document.querySelector('#hovering__timer');
    var hovering__stateAPP = document.querySelector('#hovering__state--app');
    var hovering__stateBUTTON = document.querySelector('#hovering__state--button');

    var APP_STATE_INITIAL = 'INITIAL';
    var APP_STATE_STARTED = 'STARTED';
    var APP_STATE_ENDED = 'ENDED';

    var APP_MODE_STANDARD = 'STANDARD';
    var APP_MODE_TIMER = 'TIMER';

    var INITIAL_SCALE_STATE = 0.06;
    var END_SCALE_STATE = 1;
    var SCALE_RATE = 0.0001;
    

    // state
    var appState = APP_STATE_INITIAL; // initial, started, ended
    var appMode = APP_MODE_STANDARD;
    var appHover = false;

    var timer = 0;
    var timerSetInterval = null;
    var sizeSetInterval = null;

    // scale state
    var scaleState = INITIAL_SCALE_STATE;
    var increasingScale = true;

    // events
    document.addEventListener('keydown', function(event) {
      if (event.keyCode === 13) whenPressspaceKey();
      if (event.keyCode === 32) whenPressspaceKey();
    }, false);
    hovering__button__container.onmouseover = whenMouseOverButton;
    hovering__button__container.onmouseout = whenMouseOutButton;
    
    function whenPressspaceKey(event) {
      switch(appState) {
        case APP_STATE_INITIAL: {
          if (appHover !== true) return;
        
          timerSetInterval = setInterval(startTimer, 1000);
          sizeSetInterval = setInterval(increaseSize, 100);

          setInnerText(
            hovering__message, 
            '<p>Leave your cursor within the hover space, with your hand still attached.</p>' +
            '<p>I recommend you practice for 10 minutes at a time.</p>'
          );

          setAppState(APP_STATE_STARTED);        
          break;
        }
        case APP_STATE_STARTED: {
          // if (appHover !== true) return;
          setInnerText(
            hovering__message, 
            '<p>Your session has ended. Press space to restart and try again!</p>' +
            '<p>You hovered for ' + fancyTimeFormat(timer) + '</p>'
          );

          clearInterval(timerSetInterval); 
          clearInterval(sizeSetInterval);

          setAppState(APP_STATE_ENDED);
          break;
        }
        case APP_STATE_ENDED: {
          // if (appHover !== true) return;
          setInnerText(
            hovering__message, 
            '<p>Hover on the button to begin.</p>'
          );

          setAppState(APP_STATE_INITIAL);
          break;
        }
        default: {
          throw new Error('whenMouseOutButton - appState incorrect');
        }
      }
    }

    function whenMouseOverButton(event) {
      setHoverState(true)
      addClass(hovering__button__text, 'hovering__button__text--during');

      switch(appState) {
        case APP_STATE_INITIAL: {
          setInnerText(
            hovering__message,
            '<p>Press space to start hovering.</p>'
          );
          break;
        }
        case APP_STATE_STARTED: {
          // This ends the game.
          clearInterval(timerSetInterval);
          clearInterval(sizeSetInterval);
          setInnerText(
            hovering__message,
            '<p>Your session has ended. Press space to restart and try again!</p>' +
            '<p>You hovered for ' + fancyTimeFormat(timer) + '</p>'
          );
          timer = 0;
          setInnerText(hovering__timer, fancyTimeFormat(0))
          setAppState(APP_STATE_ENDED);
          break;
        }
        case APP_STATE_ENDED: {
          hovering__button.style.transform = 'scale(' + INITIAL_SCALE_STATE + ')';
          scaleState = INITIAL_SCALE_STATE;
          break;
        }
        default: {
          throw new Error('whenMouseOverButton - appState incorrect');
        }
      }
    }

    function whenMouseOutButton(event) {
      setHoverState(false)
      removeClass(hovering__button__text, 'hovering__button__text--during');

      switch(appState) {
        case APP_STATE_INITIAL: {
          setInnerText(
            hovering__message,
            '<p>Hover on the button to begin.</p>'
          );
          break;
        }
        case APP_STATE_STARTED: {
          clearInterval(timerSetInterval);
          clearInterval(sizeSetInterval);
          setInnerText(
            hovering__message,
            '<p>Your session has ended. Press space to restart and try again!</p>' + 
            '<p>You hovered for ' + fancyTimeFormat(timer) + '</p>'
          );
          setAppState(APP_STATE_ENDED);
          break;
        }
        case APP_STATE_ENDED: {
          break;
        }
        default: {
          throw new Error('whenMouseOutButton - appState incorrect');
        }
      }
    }
 
    function addClass(element, className) {
      element.classList.add(className);
    };

    function removeClass(element, className) {
      element.classList.remove(className);
    };

    function startTimer(event) {
      timer += 1;
      setInnerText(hovering__timer, fancyTimeFormat(timer))
    }

    function increaseSize(event) {      
      if (increasingScale && scaleState < END_SCALE_STATE) {
        hovering__button.style.transform = 'scale(' + (scaleState + SCALE_RATE) + ')';
        scaleState += SCALE_RATE;
      } 
      if (increasingScale && scaleState > END_SCALE_STATE) {
        increasingScale = false;
      }

      if (!increasingScale && scaleState > INITIAL_SCALE_STATE) {
        hovering__button.style.transform = 'scale(' + (scaleState - SCALE_RATE) + ')';
        scaleState -= SCALE_RATE;
      }
      if (!increasingScale && scaleState < INITIAL_SCALE_STATE) {
        increasingScale = true;
      }
    }

    function setInnerText(element, text) {
      element.innerHTML = text;
    }

    function setAppState(state) {
      appState = state;
      hovering__stateAPP.textContent = 'App: ' + state;
    };

    function setHoverState(state) {
      appHover = state;
      hovering__stateBUTTON.textContent = 'Hovering: ' + state;
    };
    
  </script>

  <!-- util.js -->
  <script>
    function fancyTimeFormat(time) {
      // Hours, minutes and seconds
      var hrs = ~~(time / 3600);
      var mins = ~~((time % 3600) / 60);
      var secs = ~~time % 60;

      // Output like "1:01" or "4:03:59" or "123:03:59"
      var ret = "";

      if (hrs > 0) {
          ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
      }

      ret += "" + mins + ":" + (secs < 10 ? "0" : "");
      ret += "" + secs;
      return ret;
    }
  </script>
</html>

